{% extends "base.html" %}
{% load static %}
{% load humanize %}
{% block pageName %}costSavings{% endblock pageName %}
{% block title %}Cost Savings Analysis{% endblock title %}
{% block page_header %}
    {% static 'media/jacob-grishey-j8iPllhcWWg-unsplash.jpg' as cost_savings_header_image %}
    {% include "partials/page_header.html" with eyebrow="System case studies" title="Cost savings analysis" description="Quantify avoided 911 calls, ambulance transports, and emergency visits to demonstrate how community paramedic care bends the healthcare cost curve." image_src=cost_savings_header_image image_alt="Community paramedics reviewing financial impact charts" image_width="960" image_height="640" updated_at=page_header_updated_at updated_at_iso=page_header_updated_at_iso read_time=page_header_read_time %}
{% endblock page_header %}
{% block content %}
<div class="col-span-12 mx-auto w-full">
    <span data-page-name="costSavings" class="hidden" hidden></span>
    <div class="w-full py-20 space-y-40">

    {# Introduction Section #}
    <section class="mx-auto max-w-7xl">
        <p class="text-base leading-7 text-gray-700 dark:text-slate-300 sm:text-lg">
            Our community paramedic program reduces emergency system strain by connecting <span class="font-semibold text-gray-900 dark:text-white">high-utilizers</span> with appropriate care pathways. By comparing emergency service use before and after enrollment, we quantify real-world impact on <span class="font-semibold text-gray-900 dark:text-white">911 calls</span>, <span class="font-semibold text-gray-900 dark:text-white">ambulance transports</span>, and <span class="font-semibold text-gray-900 dark:text-white">ED visits</span>.
        </p>

        <dl class="mt-10 space-y-6">
            <div class="relative pl-8">
                <dt class="inline font-semibold text-gray-900 dark:text-white">
                    <div class="absolute left-0 top-1.5 h-2 w-2 rounded-full bg-slate-600 dark:bg-slate-400"></div>
                    Observed Reductions.
                </dt>
                <dd class="inline text-gray-600 dark:text-slate-400"> The metrics below represent observed reductions in emergency service utilization and their associated cost savings using conservative unit rates.</dd>
            </div>

            <div class="relative pl-8">
                <dt class="inline font-semibold text-gray-900 dark:text-white">
                    <div class="absolute left-0 top-1.5 h-2 w-2 rounded-full bg-slate-600 dark:bg-slate-400"></div>
                    Measurable Value.
                </dt>
                <dd class="inline text-gray-600 dark:text-slate-400"> These figures demonstrate how proactive, community-based care delivery generates measurable value for both patients and the healthcare system.</dd>
            </div>
        </dl>
    </section>

    {# Narrative Data Story #}
    <section class="relative">
        <div class="absolute left-8 top-0 bottom-0 w-px bg-slate-200 dark:bg-slate-800 md:left-1/2 md:-ml-px"></div>

        <div class="space-y-32">
            {# 1. 911 Calls #}
            <div class="relative grid grid-cols-1 gap-8 md:grid-cols-2 md:gap-12">
                <div class="pl-16 md:pl-0 md:text-right md:pr-12">
                    <div class="sticky top-24">
                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white">It starts with the call</h3>
                        <p class="mt-4 text-lg text-gray-600 dark:text-gray-400">
                            High utilizers often rely on 911 as their primary access point for healthcare. By providing a direct line to a community paramedic, we intercept these requests before they become emergency dispatches.
                        </p>
                        <div class="mt-6 inline-flex items-center gap-2 text-sm font-medium text-slate-500 md:justify-end">
                            <span class="h-px w-8 bg-slate-300"></span>
                            <span>Comparison of 6-month pre/post enrollment volume</span>
                        </div>
                    </div>
                </div>
                <div class="relative pl-16 md:pl-12">
                    <div class="absolute left-0 top-2 md:-top-4 flex h-16 w-16 items-center justify-center rounded-full border-4 border-white bg-slate-100 dark:border-slate-900 dark:bg-slate-800 md:left-0 md:-ml-14">
                        <span class="text-xl font-bold text-slate-500">1</span>
                    </div>
                    <div class="rounded-2xl border border-slate-200 bg-white p-8 shadow-sm dark:border-slate-700 dark:bg-slate-800">
                        <div class="flex items-baseline gap-2">
                            <span class="text-5xl font-bold tracking-tight text-gray-900 dark:text-white">{{ cost_metrics.calls_prevented }}</span>
                            <span class="text-xl font-medium text-gray-500">calls prevented</span>
                        </div>
                        <div class="mt-6 border-t border-slate-100 pt-6 dark:border-slate-700">
                            <div class="flex justify-between items-baseline">
                                <span class="text-sm font-medium text-gray-500 uppercase tracking-wider">Operational Savings</span>
                                <span class="text-2xl font-bold text-green-600 dark:text-green-400">${{ cost_metrics.savings_breakdown.911_non_transport|intcomma }}</span>
                            </div>
                            <div class="mt-4 rounded-lg bg-slate-50 p-4 text-sm text-slate-600 dark:bg-slate-900/50 dark:text-slate-400">
                                <p class="mb-2">
                                    <span class="font-semibold text-slate-900 dark:text-slate-200">Estimation Rationale:</span>
                                    Based on historical data where 42% of patients utilize 911 services, with 71% demonstrating reduced usage post-enrollment.
                                </p>
                                <p class="text-xs text-slate-500">Operational cost savings estimated at ~$1,900 per non-transport response.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {# 2. Transports #}
            <div class="relative grid grid-cols-1 gap-8 md:grid-cols-2 md:gap-12">
                <div class="order-2 md:order-1 relative pl-16 md:pl-0 md:text-right md:pr-12">
                     <div class="absolute left-0 top-2 md:-top-4 flex h-16 w-16 items-center justify-center rounded-full border-4 border-white bg-slate-100 dark:border-slate-900 dark:bg-slate-800 md:left-auto md:right-0 md:-mr-14">
                        <span class="text-xl font-bold text-slate-500">2</span>
                    </div>
                    <div class="rounded-2xl border border-slate-200 bg-white p-8 shadow-sm dark:border-slate-700 dark:bg-slate-800">
                        <div class="flex items-baseline gap-2 md:justify-end">
                            <span class="text-5xl font-bold tracking-tight text-gray-900 dark:text-white">{{ cost_metrics.transports_averted }}</span>
                            <span class="text-xl font-medium text-gray-500">transports averted</span>
                        </div>
                        <div class="mt-6 border-t border-slate-100 pt-6 dark:border-slate-700">
                            <div class="flex justify-between items-baseline">
                                <span class="text-sm font-medium text-gray-500 uppercase tracking-wider">Transport Savings</span>
                                <span class="text-2xl font-bold text-green-600 dark:text-green-400">${{ cost_metrics.savings_breakdown.transports|intcomma }}</span>
                            </div>
                            <div class="mt-4 rounded-lg bg-slate-50 p-4 text-sm text-slate-600 dark:bg-slate-900/50 dark:text-slate-400 md:text-right">
                                <p class="mb-2">
                                    <span class="font-semibold text-slate-900 dark:text-slate-200">Estimation Rationale:</span>
                                    Calculated from the 56% of 911 calls that typically result in transport to an emergency department.
                                </p>
                                <p class="text-xs text-slate-500">Operational cost savings estimated at ~$3,800 per ambulance transport.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="order-1 md:order-2 pl-16 md:pl-12">
                    <div class="sticky top-24">
                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Reducing the ride</h3>
                        <p class="mt-4 text-lg text-gray-600 dark:text-gray-400">
                            When 911 is called, transport is often the default. We provide treat-in-place options and alternative destinations, keeping ambulances available for life-threatening emergencies.
                        </p>
                    </div>
                </div>
            </div>

            {# 3. ED Visits #}
            <div class="relative grid grid-cols-1 gap-8 md:grid-cols-2 md:gap-12">
                <div class="pl-16 md:pl-0 md:text-right md:pr-12">
                    <div class="sticky top-24">
                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Keeping beds open</h3>
                        <p class="mt-4 text-lg text-gray-600 dark:text-gray-400">
                            The ER is for emergencies, not chronic care management. By managing conditions like diabetes and COPD at home, we prevent the acute exacerbations that lead to hospital visits.
                        </p>
                    </div>
                </div>
                <div class="relative pl-16 md:pl-12">
                    <div class="absolute left-0 top-2 md:-top-4 flex h-16 w-16 items-center justify-center rounded-full border-4 border-white bg-slate-100 dark:border-slate-900 dark:bg-slate-800 md:left-0 md:-ml-14">
                        <span class="text-xl font-bold text-slate-500">3</span>
                    </div>
                    <div class="rounded-2xl border border-slate-200 bg-white p-8 shadow-sm dark:border-slate-700 dark:bg-slate-800">
                        <div class="flex items-baseline gap-2">
                            <span class="text-5xl font-bold tracking-tight text-gray-900 dark:text-white">{{ cost_metrics.ed_visits_avoided }}</span>
                            <span class="text-xl font-medium text-gray-500">ED visits avoided</span>
                        </div>
                        <div class="mt-6 border-t border-slate-100 pt-6 dark:border-slate-700">
                            <div class="flex justify-between items-baseline">
                                <span class="text-sm font-medium text-gray-500 uppercase tracking-wider">Hospital Savings</span>
                                <span class="text-2xl font-bold text-green-600 dark:text-green-400">${{ cost_metrics.savings_breakdown.ed_visits|intcomma }}</span>
                            </div>
                            <div class="mt-4 rounded-lg bg-slate-50 p-4 text-sm text-slate-600 dark:bg-slate-900/50 dark:text-slate-400">
                                <p class="mb-2">
                                    <span class="font-semibold text-slate-900 dark:text-slate-200">Estimation Rationale:</span>
                                    Based on 51% patient ED utilization rate, with 69% showing reduced visits after engagement.
                                </p>
                                <p class="text-xs text-slate-500">Savings estimated at ~$1,146 per ED encounter.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    {# Total Impact #}
    <section class="relative overflow-hidden rounded-3xl bg-slate-900 px-6 py-24 shadow-2xl sm:px-12">
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-slate-800/50 via-slate-900 to-slate-900"></div>
        <div class="relative mx-auto max-w-2xl text-center">
            <h2 class="text-3xl font-bold tracking-tight text-white sm:text-4xl">Total System Impact</h2>
            <p class="mt-4 text-lg text-slate-400">
                By intervening upstream, we've generated significant cost avoidance across the local healthcare ecosystem.
            </p>
            <div class="mt-10 flex items-center justify-center">
                <span class="text-6xl font-bold tracking-tight text-green-400 sm:text-7xl">${{ cost_metrics.total_savings|intcomma }}</span>
            </div>
            <p class="mt-4 text-sm font-medium text-slate-500">Cumulative savings from all avoided utilization</p>
        </div>
    </section>
    <section class="mx-auto max-w-7xl">
        {# Yearly Savings Table #}
        <div class="overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900">
            <div
                class="w-full overflow-x-auto"
                x-data="(() => {
                    const el = document.getElementById('yearly-breakdown-data');
                    const rows = el ? JSON.parse(el.textContent) : [];
                    return {
                        rows,
                        sortKey: 'year',
                        sortDir: 'desc',
                        setSort(key) {
                            if (this.sortKey === key) {
                                this.sortDir = this.sortDir === 'asc' ? 'desc' : 'asc';
                            } else {
                                this.sortKey = key;
                                this.sortDir = 'asc';
                            }
                        },
                        sortedRows() {
                            return [...this.rows].sort((a, b) => {
                                const va = a[this.sortKey];
                                const vb = b[this.sortKey];
                                return (va === vb ? 0 : va > vb ? 1 : -1) * (this.sortDir === 'asc' ? 1 : -1);
                            });
                        },
                        formatNumber(n) { try { return new Intl.NumberFormat().format(n ?? 0); } catch { return n; } },
                        formatCurrency(n) { try { return '$' + new Intl.NumberFormat(undefined, { maximumFractionDigits: 0 }).format(n ?? 0); } catch { return '$' + n; } }
                    }
                })()"
            >
                <script type="application/json" id="yearly-breakdown-data">
                    [
                    {% for row in cost_metrics.yearly_breakdown %}
                        {"year": {{ row.year }}, "patients": {{ row.patients }}, "calls": {{ row.calls_prevented }}, "transports": {{ row.transports_averted }}, "ed": {{ row.ed_visits_avoided }}, "total": {{ row.total_savings }} }{% if not forloop.last %},{% endif %}
                    {% endfor %}
                    ]
                </script>
                <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-800">
                    <thead class="bg-slate-50 dark:bg-slate-800/50">
                        <tr>
                            <th scope="col" class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400 cursor-pointer select-none group" @click="setSort('year')">
                                <div class="flex items-center gap-2">
                                    <span>Year</span>
                                    <span class="rounded text-slate-400 group-hover:bg-slate-200 dark:group-hover:bg-slate-700 p-0.5 transition-colors">
                                        <svg viewBox="0 0 24 24" x-bind:class="`h-4 w-4 transition-transform stroke-2 stroke-current fill-none ${sortKey==='year' && sortDir==='asc' ? 'rotate-180' : ''} ${sortKey==='year' ? 'opacity-100' : 'opacity-0 group-hover:opacity-50'}`">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                                        </svg>
                                    </span>
                                </div>
                            </th>
                            <th scope="col" class="px-6 py-4 text-right text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400 cursor-pointer select-none group" @click="setSort('patients')">
                                <div class="flex items-center justify-end gap-2">
                                    <span>Patients</span>
                                    <span class="rounded text-slate-400 group-hover:bg-slate-200 dark:group-hover:bg-slate-700 p-0.5 transition-colors">
                                        <svg viewBox="0 0 24 24" x-bind:class="`h-4 w-4 transition-transform stroke-2 stroke-current fill-none ${sortKey==='patients' && sortDir==='asc' ? 'rotate-180' : ''} ${sortKey==='patients' ? 'opacity-100' : 'opacity-0 group-hover:opacity-50'}`">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                                        </svg>
                                    </span>
                                </div>
                            </th>
                            <th scope="col" class="px-6 py-4 text-right text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400 cursor-pointer select-none group" @click="setSort('calls')">
                                <div class="flex items-center justify-end gap-2">
                                    <span>911 Calls</span>
                                    <span class="rounded text-slate-400 group-hover:bg-slate-200 dark:group-hover:bg-slate-700 p-0.5 transition-colors">
                                        <svg viewBox="0 0 24 24" x-bind:class="`h-4 w-4 transition-transform stroke-2 stroke-current fill-none ${sortKey==='calls' && sortDir==='asc' ? 'rotate-180' : ''} ${sortKey==='calls' ? 'opacity-100' : 'opacity-0 group-hover:opacity-50'}`">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                                        </svg>
                                    </span>
                                </div>
                            </th>
                            <th scope="col" class="px-6 py-4 text-right text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400 cursor-pointer select-none group" @click="setSort('transports')">
                                <div class="flex items-center justify-end gap-2">
                                    <span>Transports</span>
                                    <span class="rounded text-slate-400 group-hover:bg-slate-200 dark:group-hover:bg-slate-700 p-0.5 transition-colors">
                                        <svg viewBox="0 0 24 24" x-bind:class="`h-4 w-4 transition-transform stroke-2 stroke-current fill-none ${sortKey==='transports' && sortDir==='asc' ? 'rotate-180' : ''} ${sortKey==='transports' ? 'opacity-100' : 'opacity-0 group-hover:opacity-50'}`">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                                        </svg>
                                    </span>
                                </div>
                            </th>
                            <th scope="col" class="px-6 py-4 text-right text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400 cursor-pointer select-none group" @click="setSort('ed')">
                                <div class="flex items-center justify-end gap-2">
                                    <span>ED Visits</span>
                                    <span class="rounded text-slate-400 group-hover:bg-slate-200 dark:group-hover:bg-slate-700 p-0.5 transition-colors">
                                        <svg viewBox="0 0 24 24" x-bind:class="`h-4 w-4 transition-transform stroke-2 stroke-current fill-none ${sortKey==='ed' && sortDir==='asc' ? 'rotate-180' : ''} ${sortKey==='ed' ? 'opacity-100' : 'opacity-0 group-hover:opacity-50'}`">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                                        </svg>
                                    </span>
                                </div>
                            </th>
                            <th scope="col" class="px-6 py-4 text-right text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400 cursor-pointer select-none group" @click="setSort('total')">
                                <div class="flex items-center justify-end gap-2">
                                    <span>Total Savings</span>
                                    <span class="rounded text-slate-400 group-hover:bg-slate-200 dark:group-hover:bg-slate-700 p-0.5 transition-colors">
                                        <svg viewBox="0 0 24 24" x-bind:class="`h-4 w-4 transition-transform stroke-2 stroke-current fill-none ${sortKey==='total' && sortDir==='asc' ? 'rotate-180' : ''} ${sortKey==='total' ? 'opacity-100' : 'opacity-0 group-hover:opacity-50'}`">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                                        </svg>
                                    </span>
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-200 bg-white dark:divide-slate-800 dark:bg-slate-900">
                        <template x-for="row in sortedRows()" :key="row.year">
                            <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors">
                                <td class="whitespace-nowrap px-6 py-4 text-sm font-medium text-slate-900 dark:text-white" x-text="row.year"></td>
                                <td class="whitespace-nowrap px-6 py-4 text-right text-sm text-slate-600 dark:text-slate-300 tabular-nums" x-text="formatNumber(row.patients)"></td>
                                <td class="whitespace-nowrap px-6 py-4 text-right text-sm text-slate-600 dark:text-slate-300 tabular-nums" x-text="formatNumber(row.calls)"></td>
                                <td class="whitespace-nowrap px-6 py-4 text-right text-sm text-slate-600 dark:text-slate-300 tabular-nums" x-text="formatNumber(row.transports)"></td>
                                <td class="whitespace-nowrap px-6 py-4 text-right text-sm text-slate-600 dark:text-slate-300 tabular-nums" x-text="formatNumber(row.ed)"></td>
                                <td class="whitespace-nowrap px-6 py-4 text-right text-sm font-bold text-green-600 dark:text-green-400 tabular-nums" x-text="formatCurrency(row.total)"></td>
                            </tr>
                        </template>
                        <tr x-show="rows.length === 0">
                            <td colspan="6" class="px-6 py-8 text-center text-sm text-slate-500 dark:text-slate-400">No yearly data available.</td>
                        </tr>
                    </tbody>
                    <tfoot class="bg-slate-50 dark:bg-slate-800/50">
                        <tr>
                            <td class="px-6 py-4 text-left text-sm font-bold text-slate-900 dark:text-white">Totals</td>
                            <td class="px-6 py-4 text-right text-sm font-bold text-slate-900 dark:text-white tabular-nums">{{ cost_metrics.total_patients }}</td>
                            <td class="px-6 py-4 text-right text-sm font-bold text-slate-900 dark:text-white tabular-nums">{{ cost_metrics.calls_prevented }}</td>
                            <td class="px-6 py-4 text-right text-sm font-bold text-slate-900 dark:text-white tabular-nums">{{ cost_metrics.transports_averted }}</td>
                            <td class="px-6 py-4 text-right text-sm font-bold text-slate-900 dark:text-white tabular-nums">{{ cost_metrics.ed_visits_avoided }}</td>
                            <td class="px-6 py-4 text-right text-sm font-bold text-green-600 dark:text-green-400 tabular-nums">${{ cost_metrics.total_savings|intcomma }}</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </section>
    </div>
</div>
{% endblock content %}
