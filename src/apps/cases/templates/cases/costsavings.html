{% extends "base.html" %}
{% load static %}
{% load humanize %}
{% block pageName %}costSavings{% endblock pageName %}
{% block title %}Cost Savings Analysis{% endblock title %}
{% block page_header %}
{% static 'media/jacob-grishey-j8iPllhcWWg-unsplash.jpg' as cost_savings_header_image %}
{% with eyebrow="System case studies" title="Cost savings analysis" description="Quantify avoided 911 calls, transports, and emergency visits to show how CPM care bends the cost curve." image_src=cost_savings_header_image image_alt="Community paramedics reviewing financial impact charts" image_width="960" image_height="640" updated_at=page_header_updated_at updated_at_iso=page_header_updated_at_iso read_time=page_header_read_time %}
    {% include "partials/page_header.html" %}
{% endwith %}
{% endblock page_header %}
{% block content %}
<div class="col-span-12 mx-auto mt-16 w-full max-w-7xl">
    <span data-page-name="costSavings" class="hidden" hidden></span>
    <div class="space-y-16">
<!-- Stats Page Section With Background Image -->
<section class="col-span-12">
    <div class="relative isolate overflow-hidden bg-white dark:bg-gray-900 px-6 sm:px-12 md:px-20 py-20 rounded-2xl shadow-md lg:overflow-visible">
        <!-- Background photo -->
        <div class="absolute inset-0 -z-20 bg-center bg-cover bg-no-repeat rounded-2xl"
                style="background-image: url('{% static 'media/jacob-grishey-j8iPllhcWWg-unsplash.jpg' %}');
                    filter: contrast(1.35) brightness(0.9) saturate(1.2)"></div>
        <!-- Extra dark overlay for image contrast -->
        <div class="absolute inset-0 -z-10 bg-black opacity-80 rounded-2xl"></div>
        <div class="mx-auto grid max-w-2xl grid-cols-1 gap-x-8 gap-y-16 lg:mx-0 lg:max-w-none lg:items-start lg:gap-y-10">
            <div class="mx-auto">
                <!-- Section Label -->
                <p class="text-base/7 font-semibold text-indigo-600 dark:text-indigo-400">Community Paramedic Program</p>
                <!-- Main Heading -->
                <h2 class="mt-2 text-4xl font-semibold tracking-tight text-pretty text-gray-900 dark:text-white sm:text-5xl">
                    Cost Savings Analysis
                </h2>
                <!-- Description -->
                <p class="mt-6 text-xl/8 text-gray-700 dark:text-gray-300">
                    When fire department paramedics step beyond traditional
                    emergency response to deliver healthcare directly into homes
                    and communities, the impact extends far beyond individual
                    lives touched. Our Community Paramedic program prevents
                    unnecessary 911 calls, reduces emergency department
                    overutilization, and brings primary care to those who need
                    it most—homebound patients, individuals with chronic
                    conditions, and vulnerable populations facing barriers to
                    traditional healthcare access.
                </p>
            </div>
        </div>
        <!-- Key Stats -->
        <div class="mt-16 w-full grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-0 text-left text-lg font-medium">
            <div class="flex flex-col border-l-1 border-gray-700 pl-6 py-2">
                <p class="text-3xl font-extrabold text-white">{{ cost_metrics.calls_prevented }}</p>
                <p class="text-gray-400">911 Calls Prevented</p>
            </div>
            <div class="flex flex-col border-l-1 border-gray-700 pl-6 py-2">
                <p class="text-3xl font-extrabold text-white">{{ cost_metrics.transports_averted }}</p>
                <p class="text-gray-400">Ambulance Transports Averted</p>
            </div>
            <div class="flex flex-col border-l-1 border-gray-700 pl-6 py-2">
                <p class="text-3xl font-extrabold text-white">{{ cost_metrics.ed_visits_avoided }}</p>
                <p class="text-gray-400">ED Visits Avoided</p>
            </div>
            <div class="flex flex-col border-l-1 border-gray-700 pl-6 py-2">
                <p class="text-3xl font-extrabold text-white">${{ cost_metrics.total_savings|intcomma }}</p>
                <p class="text-gray-400">Total System Savings</p>
            </div>
        </div>
        <!-- Background overlay -->
        <div class="absolute inset-0 bg-gradient-to-br from-gray-800 via-gray-900 to-black opacity-60 rounded-2xl -z-10"></div>
    </div>
</section>
<!-- Utilization & Avoided Costs — Narrative -->
<section class="col-span-12 relative">
    <div class="relative isolate overflow-hidden bg-white dark:bg-gray-900 px-6 sm:px-12 md:px-20 lg:overflow-visible">
        <!-- divider -->
        <div class="mt-12 mb-16">
            <div class="h-px bg-gradient-to-r from-transparent via-gray-300/60 to-transparent dark:via-white/15"></div>
        </div>
        <div class="mx-auto grid max-w-2xl grid-cols-1 gap-x-8 gap-y-16 lg:mx-0 lg:max-w-none lg:items-start lg:gap-y-10">
            <header class="text-left">
                <p class="text-base/7 font-semibold text-indigo-600 dark:text-indigo-400">Utilization & Avoided Costs</p>
                <h2 class="mt-2 text-3xl sm:text-4xl font-semibold tracking-tight text-gray-900 dark:text-white">
                    Observed changes after program enrollment
                </h2>
                <p class="mt-3 text-md sm:text-base text-gray-700 dark:text-gray-300 max-w-prose">
                    We compare each patient’s emergency service use in equal pre/post windows anchored to enrollment. Results summarize observed changes and associated avoided costs using conservative unit rates.
                </p>
            </header>
            <!-- KPI row -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                <!-- Calls Prevented -->
                <div class="group relative overflow-hidden p-4 rounded-2xl ring-1 ring-gray-200 dark:ring-white/10 bg-white/50 dark:bg-white/[0.04] transition-all duration-300 hover:shadow-md hover:ring-indigo-400/30 hover:bg-gradient-to-br hover:from-indigo-500/10 hover:to-cyan-500/10">
                    <h3 class="text-sm font-medium uppercase tracking-wide text-gray-500 dark:text-gray-400">911 calls prevented</h3>
                    <p class="mt-1 text-3xl font-semibold text-gray-900 dark:text-white tabular-nums">
                        {{ cost_metrics.calls_prevented }}
                    </p>
                    <p class="mt-3 text-sm text-gray-700 dark:text-gray-300">
                        Cost avoided:
                        <span class="font-medium text-gray-900 dark:text-green-400 tabular-nums">${{ cost_metrics.savings_breakdown.911_non_transport|intcomma }}
                        </span>
                    </p>
                    <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                        Rationale: 2024 example • 118 calls prevented; 42%
                        of patients used 911; 71% (121) had reduced 911 use.
                        Non‑transport unit rate ≈ ~$1,900.
                    </p>
                </div>
                <!-- Transports Averted -->
                <div class="group relative overflow-hidden p-4 rounded-2xl ring-1 ring-gray-200 dark:ring-white/10 bg-white/50 dark:bg-white/[0.04] transition-all duration-300 hover:shadow-md hover:ring-indigo-400/30 hover:bg-gradient-to-br hover:from-indigo-500/10 hover:to-cyan-500/10">
                    <h3 class="text-sm font-medium uppercase tracking-wide text-gray-500 dark:text-gray-400">
                        Ambulance transports averted
                    </h3>
                    <p class="mt-1 text-3xl font-semibold text-gray-900 dark:text-white tabular-nums">
                        {{ cost_metrics.transports_averted }}
                    </p>
                    <p class="mt-3 text-sm text-gray-700 dark:text-gray-300">
                        Cost avoided:
                        <span class="font-medium text-gray-900 dark:text-green-400 tabular-nums">${{ cost_metrics.savings_breakdown.transports|intcomma }}</span>
                    </p>
                    <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                        Rationale: 2024 example • 56% of 911 calls result in
                        ambulance transport to ER • CPM intervention prevented
                        68 ambulance transports = ~$3,800 per transport.
                    </p>
                </div>
                <!-- ED Visits Avoided -->
                <div class="group relative overflow-hidden p-4 rounded-2xl ring-1 ring-gray-200 dark:ring-white/10 bg-white/50 dark:bg-white/[0.04] transition-all duration-300 hover:shadow-md hover:ring-indigo-400/30 hover:bg-gradient-to-br hover:from-indigo-500/10 hover:to-cyan-500/10">
                    <h3 class="text-sm font-medium uppercase tracking-wide text-gray-500 dark:text-gray-400">ED visits avoided</h3>
                    <p class="mt-1 text-3xl font-semibold text-gray-900 dark:text-white tabular-nums">
                        {{ cost_metrics.ed_visits_avoided }}
                    </p>
                    <p class="mt-3 text-sm text-gray-700 dark:text-gray-300">
                        Cost avoided:
                        <span class="font-medium text-gray-900 dark:text-green-400 tabular-nums">${{ cost_metrics.savings_breakdown.ed_visits|intcomma }}
                        </span>
                    </p>
                    <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                        Rationale: 2024 example — 144 ED visits prevented; 69%
                        had reduced ER use. Unit cost ≈ $1,146 per ED encounter.
                    </p>
                </div>
            </div>
            <!-- Methods + Limitations -->
            <div class="mt-0 rounded-2xl bg-white/50 dark:bg-gray-900/40 backdrop-blur-sm">
                <p class="text-[11px] font-semibold tracking-wide text-gray-600 dark:text-gray-300 uppercase mb-2">
                    Methods (pre–post within-person)
                </p>
                <ul class="space-y-2 text-[0.95rem] text-gray-700 dark:text-gray-300 leading-relaxed">
                    <li class="flex gap-2">
                        <span class="mt-2 h-1.5 w-1.5 rounded-full bg-green-400"></span>Equal-length windows (e.g., 6 months) before and after
                        enrollment, per patient.
                    </li>
                    <li class="flex gap-2">
                        <span class="mt-2 h-1.5 w-1.5 rounded-full bg-green-400"></span>Metrics: 911 call volume, ambulance transports, and ED
                        encounters.
                    </li>
                    <li class="flex gap-2">
                        <span class="mt-2 h-1.5 w-1.5 rounded-full bg-green-400"></span>Changes linked to documented clinical contacts within
                        the observation window.
                    </li>
                    <li class="flex gap-2">
                        <span class="mt-2 h-1.5 w-1.5 rounded-full bg-green-400"></span>Costs use conservative base rates;
                        procedures/diagnostics not included.
                    </li>
                </ul>
            </div>
        </div>
    </div>
</section>
<!-- Year-by-Year Savings -->
<section class="col-span-12">
    <div class="px-6 sm:px-12 md:px-20 lg:overflow-visible">
        <!-- divider -->
        <div class="my-16">
            <div class="h-px bg-gradient-to-r from-transparent via-gray-300/60 to-transparent dark:via-white/15"></div>
        </div>
        <div class="overflow-hidden bg-white/60 dark:bg-gray-900/40 backdrop-blur-sm">
            <div class="py-4">
                <p class="text-base/7 font-semibold text-indigo-600 dark:text-indigo-400">Year-by-Year Savings</p>
                <h2 class="mt-2 text-3xl sm:text-4xl font-semibold tracking-tight text-gray-900 dark:text-white">
                    Annual avoided costs and utilization
                </h2>
                <p class="mt-3 mb-4 text-md sm:text-base text-gray-700 dark:text-gray-300 max-w-prose">
                    Annual totals by year for patients served, 911 calls prevented, transports averted, ED visits avoided, and total system savings.
                </p>
            </div>
            <!-- Yearly Savings Table -->
            <div
                class="relative flex flex-col w-full bg-white/60 dark:bg-gray-900/40 shadow-sm rounded-2xl bg-clip-border ring-1 ring-white/10 mt-2 overflow-x-auto md:overflow-x-visible overflow-y-visible"
                x-data="(() => {
                    const el = document.getElementById('yearly-breakdown-data');
                    const rows = el ? JSON.parse(el.textContent) : [];
                    return {
                        rows,
                        sortKey: 'year',
                        sortDir: 'desc',
                        setSort(key) {
                            if (this.sortKey === key) {
                                this.sortDir = this.sortDir === 'asc' ? 'desc' : 'asc';
                            } else {
                                this.sortKey = key;
                                this.sortDir = 'asc';
                            }
                        },
                        sortedRows() {
                            return [...this.rows].sort((a, b) => {
                                const va = a[this.sortKey];
                                const vb = b[this.sortKey];
                                return (va === vb ? 0 : va > vb ? 1 : -1) * (this.sortDir === 'asc' ? 1 : -1);
                            });
                        },
                        formatNumber(n) { try { return new Intl.NumberFormat().format(n ?? 0); } catch { return n; } },
                        formatCurrency(n) { try { return '$' + new Intl.NumberFormat(undefined, { maximumFractionDigits: 0 }).format(n ?? 0); } catch { return '$' + n; } }
                    }
                })()"
            >
                <script type="application/json" id="yearly-breakdown-data">
                    [
                    {% for row in cost_metrics.yearly_breakdown %}
                        {"year": {{ row.year }}, "patients": {{ row.patients }}, "calls": {{ row.calls_prevented }}, "transports": {{ row.transports_averted }}, "ed": {{ row.ed_visits_avoided }}, "total": {{ row.total_savings }} }{% if not forloop.last %},{% endif %}
                    {% endfor %}
                    ]
                </script>
                <table class="w-full text-left table-auto">
                    <thead>
                        <tr>
                            <th class="p-4 sm:pl-6 border-b border-gray-200/60 bg-gray-50 dark:bg-white/[0.04] text-gray-700 dark:text-gray-300" :aria-sort="sortKey==='year' ? (sortDir==='asc' ? 'ascending' : 'descending') : 'none'">
                                <button type="button" class="w-full flex items-center justify-between gap-2 text-sm font-medium leading-none cursor-pointer select-none" @click="setSort('year')">
                                    <span>Year</span>
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 opacity-60" :class="{'rotate-180': sortKey==='year' && sortDir==='asc'}">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" />
                                    </svg>
                                </button>
                            </th>
                            <th class="p-4 border-b border-gray-200/60 bg-gray-50 dark:bg-white/[0.04] text-gray-700 dark:text-gray-300" :aria-sort="sortKey==='patients' ? (sortDir==='asc' ? 'ascending' : 'descending') : 'none'">
                                <button type="button" class="w-full flex items-center justify-between gap-2 text-sm font-medium leading-none cursor-pointer select-none" @click="setSort('patients')">
                                    <span>Patients</span>
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 opacity-60" :class="{'rotate-180': sortKey==='patients' && sortDir==='asc'}">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" />
                                    </svg>
                                </button>
                            </th>
                            <th class="p-4 border-b border-gray-200/60 bg-gray-50 dark:bg-white/[0.04] text-gray-700 dark:text-gray-300" :aria-sort="sortKey==='calls' ? (sortDir==='asc' ? 'ascending' : 'descending') : 'none'">
                                <button type="button" class="w-full flex items-center justify-between gap-2 text-sm font-medium leading-none cursor-pointer select-none" @click="setSort('calls')">
                                    <span>911</span>
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 opacity-60" :class="{'rotate-180': sortKey==='calls' && sortDir==='asc'}">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" />
                                    </svg>
                                </button>
                            </th>
                            <th class="p-4 border-b border-gray-200/60 bg-gray-50 dark:bg-white/[0.04] text-gray-700 dark:text-gray-300" :aria-sort="sortKey==='transports' ? (sortDir==='asc' ? 'ascending' : 'descending') : 'none'">
                                <button type="button" class="w-full flex items-center justify-between gap-2 text-sm font-medium leading-none cursor-pointer select-none" @click="setSort('transports')">
                                    <span>Transports</span>
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 opacity-60" :class="{'rotate-180': sortKey==='transports' && sortDir==='asc'}">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" />
                                    </svg>
                                </button>
                            </th>
                            <th class="p-4 border-b border-gray-200/60 bg-gray-50 dark:bg-white/[0.04] text-gray-700 dark:text-gray-300" :aria-sort="sortKey==='ed' ? (sortDir==='asc' ? 'ascending' : 'descending') : 'none'">
                                <button type="button" class="w-full flex items-center justify-between gap-2 text-sm font-medium leading-none cursor-pointer select-none" @click="setSort('ed')">
                                    <span>ED</span>
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 opacity-60" :class="{'rotate-180': sortKey==='ed' && sortDir==='asc'}">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" />
                                    </svg>
                                </button>
                            </th>
                            <th class="p-4 border-b border-gray-200/60 bg-gray-50 dark:bg-white/[0.04] text-gray-700 dark:text-gray-300" :aria-sort="sortKey==='total' ? (sortDir==='asc' ? 'ascending' : 'descending') : 'none'">
                                <button type="button" class="w-full flex items-center justify-between gap-2 text-sm font-medium leading-none cursor-pointer select-none" @click="setSort('total')">
                                    <span>Total</span>
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="w-4 h-4 opacity-60" :class="{'rotate-180': sortKey==='total' && sortDir==='asc'}">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" />
                                    </svg>
                                </button>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="row in sortedRows()" :key="row.year">
                            <tr class="hover:bg-gray-50 dark:hover:bg-white/[0.06]">
                                <td class="p-4 sm:pl-6 border-b border-gray-200/60 dark:border-white/10">
                                    <p class="block text-sm text-gray-900 dark:text-white font-medium" x-text="row.year"></p>
                                </td>
                                <td class="p-4 border-b border-gray-200/60 dark:border-white/10">
                                    <p class="block text-sm text-gray-800 dark:text-gray-200 text-right tabular-nums" x-text="formatNumber(row.patients)"></p>
                                </td>
                                <td class="p-4 border-b border-gray-200/60 dark:border-white/10">
                                    <p class="block text-sm text-gray-800 dark:text-gray-200 text-right tabular-nums" x-text="formatNumber(row.calls)"></p>
                                </td>
                                <td class="p-4 border-b border-gray-200/60 dark:border-white/10">
                                    <p class="block text-sm text-gray-800 dark:text-gray-200 text-right tabular-nums" x-text="formatNumber(row.transports)"></p>
                                </td>
                                <td class="p-4 border-b border-gray-200/60 dark:border-white/10">
                                    <p class="block text-sm text-gray-800 dark:text-gray-200 text-right tabular-nums" x-text="formatNumber(row.ed)"></p>
                                </td>
                                <td class="p-4 border-b border-gray-200/60 dark:border-white/10">
                                    <p class="block text-sm text-gray-900 dark:text-white text-right font-semibold tabular-nums" x-text="formatCurrency(row.total)"></p>
                                </td>
                            </tr>
                        </template>
                        <tr x-show="rows.length === 0">
                            <td colspan="6" class="p-4 text-center text-xs text-gray-500 dark:text-gray-500">No yearly data available.</td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr class="bg-gray-50 dark:bg-white/[0.04]">
                            <th class="p-4 sm:pl-6 border-t border-gray-200/60 dark:border-white/10 text-left text-gray-900 dark:text-white font-medium">Totals</th>
                            <th class="p-4 border-t border-gray-200/60 dark:border-white/10 text-right text-gray-900 dark:text-white font-semibold tabular-nums">{{ cost_metrics.total_patients }}</th>
                            <th class="p-4 border-t border-gray-200/60 dark:border-white/10 text-right text-gray-900 dark:text-white font-semibold tabular-nums">{{ cost_metrics.calls_prevented }}</th>
                            <th class="p-4 border-t border-gray-200/60 dark:border-white/10 text-right text-gray-900 dark:text-white font-semibold tabular-nums">{{ cost_metrics.transports_averted }}</th>
                            <th class="p-4 border-t border-gray-200/60 dark:border-white/10 text-right text-gray-900 dark:text-white font-semibold tabular-nums">{{ cost_metrics.ed_visits_avoided }}</th>
                            <th class="p-4 border-t border-gray-200/60 dark:border-white/10 text-right text-gray-900 dark:text-white font-semibold tabular-nums">${{ cost_metrics.total_savings|intcomma }}</th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</section>
</div>
</div>
{% endblock content %}
