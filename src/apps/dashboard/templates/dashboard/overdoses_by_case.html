{% extends 'base.html' %}
{% load static %}

{% block pageName %}overdoses_by_case{% endblock pageName %}
{% block title %} OD Referrals - All Cases Analysis {% endblock title %}

{% block content %}
<!-- Introduction - Full Width -->
<section class="col-span-12 mb-16">
    <div class="relative isolate overflow-hidden bg-white dark:bg-gray-900 px-2 py-12 sm:px-4 sm:py-16 lg:overflow-visible lg:px-0">
        <div class="absolute inset-0 -z-10 overflow-hidden">
            <svg class="absolute top-0 left-[max(50%,25rem)] h-256 w-512 -translate-x-1/2 mask-[radial-gradient(64rem_64rem_at_top,white,transparent)] dark:mask-[radial-gradient(64rem_64rem_at_top,black,transparent)] stroke-gray-200 dark:stroke-gray-700" aria-hidden="true">
                <defs>
                    <pattern id="e813992c-7d03-4cc4-a2bd-151760b470a0" width="200" height="200" x="50%" y="-1" patternUnits="userSpaceOnUse">
                        <path d="M100 200V.5M.5 .5H200" fill="none" />
                    </pattern>
                </defs>
                <svg x="50%" y="-1" class="overflow-visible fill-gray-50 dark:fill-gray-800">
                    <path d="M-100.5 0h201v201h-201Z M699.5 0h201v201h-201Z M499.5 400h201v201h-201Z M-300.5 600h201v201h-201Z" stroke-width="0" />
                </svg>
                <rect width="100%" height="100%" stroke-width="0" fill="url(#e813992c-7d03-4cc4-a2bd-151760b470a0)" />
            </svg>
        </div>
        <div class="mx-auto grid max-w-2xl grid-cols-1 gap-x-8 gap-y-12 lg:mx-0 lg:max-w-none lg:grid-cols-2 lg:items-start lg:gap-y-10">
            <div class="lg:col-span-2 lg:col-start-1 lg:row-start-1 lg:mx-auto lg:grid lg:w-full lg:grid-cols-2 lg:gap-x-8 lg:px-8">
                <div class="lg:pr-4">
                    <div class="lg:max-w-2xl">
                        <p class="text-base/7 font-semibold text-indigo-600 dark:text-indigo-400">Post Overdose Response Team (PORT)</p>
                        <h1 class="mt-2 text-4xl font-semibold tracking-tight text-pretty text-gray-900 dark:text-white sm:text-5xl">
                            Comprehensive Case Analysis
                        </h1>
                        <p class="mt-6 text-xl/8 text-gray-700 dark:text-gray-300">
                            Every overdose case tells a story. By visualizing all cases with temporal context and incarceration 
                            patterns, we gain deeper insights into the cyclical nature of addiction, system interactions, and 
                            intervention opportunities that drive better outcomes for our community.
                        </p>
                    </div>
                </div>
            </div>

            <div class="lg:sticky lg:top-4 lg:col-start-2 lg:row-span-2 lg:row-start-1 lg:overflow-hidden">
                <!-- Key Statistics Cards -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Case Overview</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div>
                                <dt class="text-sm text-gray-500 dark:text-gray-400">Total Cases</dt>
                                <dd class="text-xl font-bold text-gray-900 dark:text-white">{{ total_cases|default:"--" }}</dd>
                            </div>
                            <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div>
                                <dt class="text-sm text-gray-500 dark:text-gray-400">Unique Patients</dt>
                                <dd class="text-xl font-bold text-green-600 dark:text-green-400">{{ unique_patients|default:"--" }}</dd>
                            </div>
                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div>
                                <dt class="text-sm text-gray-500 dark:text-gray-400">Fatal Cases</dt>
                                <dd class="text-xl font-bold text-red-600 dark:text-red-400">{{ fatal_cases|default:"--" }}</dd>
                            </div>
                            <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div>
                                <dt class="text-sm text-gray-500 dark:text-gray-400">Cases with Incarceration</dt>
                                <dd class="text-xl font-bold text-orange-600 dark:text-orange-400">{{ cases_with_jail|default:"--" }}</dd>
                            </div>
                            <div class="w-3 h-3 bg-orange-500 rounded-full"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-2 lg:col-start-1 lg:row-start-2 lg:mx-auto lg:grid lg:w-full lg:grid-cols-2 lg:gap-x-8 lg:px-8">
                <div class="lg:pr-4">
                    <div class="lg:max-w-2xl text-base/7 text-gray-700 dark:text-gray-300">
                        <p class="mt-6 text-gray-700 dark:text-gray-300">
                            The comprehensive case view reveals patterns that individual case analysis might miss. Temporal clustering, 
                            incarceration cycles, and patient trajectories become visible when viewed collectively.
                        </p>

                        <h2 class="mt-16 text-2xl font-bold tracking-tight text-gray-900 dark:text-white flex items-center">
                            <svg class="w-6 h-6 mr-3 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 0 0 6 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0 1 18 16.5h-2.25m-7.5 0h7.5m-7.5 0-1 3m8.5-3 1 3m0 0-1-3m1 3v-11.25A2.25 2.25 0 0 0 18 5.25h-2.25m0 13.5h-2.25m0 0V9m0 7.5h-2.25M13.5 9H18" />
                            </svg>
                            Comprehensive Case Visualization
                        </h2>
                        <p class="mt-6">
                            By plotting all cases on a single timeline, we can identify system-wide patterns, intervention opportunities, 
                            and resource allocation needs that inform strategic decision-making.
                        </p>
                        <ul role="list" class="mt-8 space-y-8 text-gray-600 dark:text-gray-400 list-disc pl-5">
                            <li>
                                <span>
                                    <strong class="font-semibold text-gray-900 dark:text-white">Pattern Recognition.</strong> Cluster analysis reveals geographic hotspots, temporal trends, and high-risk periods requiring increased surveillance.
                                </span>
                            </li>
                            <li>
                                <span>
                                    <strong class="font-semibold text-gray-900 dark:text-white">Incarceration Impact.</strong> Red line segments show jail periods, revealing how incarceration affects overdose timing and patient vulnerability upon release.
                                </span>
                            </li>
                            <li>
                                <span>
                                    <strong class="font-semibold text-gray-900 dark:text-white">Resource Planning.</strong> Comprehensive case data helps predict staffing needs, optimize response protocols, and allocate resources effectively.
                                </span>
                            </li>
                            <li>
                                <span>
                                    <strong class="font-semibold text-gray-900 dark:text-white">Outcome Tracking.</strong> Fatal outcomes (red diamonds) help identify factors associated with increased mortality risk.
                                </span>
                            </li>
                        </ul>

                        <h2 class="mt-16 text-2xl font-bold tracking-tight text-gray-900 dark:text-white flex items-center">
                            <svg class="w-6 h-6 mr-3 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                            Critical Intervention Points
                        </h2>
                        <p class="mt-6">
                            The visualization reveals critical intervention points where Community Paramedics can make the greatest impact: 
                            post-incarceration releases, clustered overdose events, and periods of increased community vulnerability.
                        </p>

                        <h2 class="mt-16 text-2xl font-bold tracking-tight text-gray-900 dark:text-white flex items-center">
                            <svg class="w-6 h-6 mr-3 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            Data-Driven Decision Making
                        </h2>
                        <p class="mt-6">
                            This comprehensive view enables evidence-based program adjustments, targeted outreach strategies, and proactive 
                            intervention planning that maximizes the impact of limited resources while improving patient outcomes.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- All Cases Scatter Plot Section -->
<section class="col-span-12 mb-16">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
        <div class="mb-4">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">All Overdose Cases Timeline</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">
                Interactive timeline showing all overdose cases with incarceration periods. Red diamonds indicate fatal outcomes. 
                Red line segments show periods of incarceration. Each row represents one patient's overdose history.
            </p>
        </div>
        <div class="chart-container">
            {% autoescape off %}{{ all_cases_scatter_plot|safe }}{% endautoescape %}
        </div>
    </div>
</section>

<!-- Key Insights Section -->
<section class="col-span-12 mb-16">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">Key Insights from Case Analysis</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                <div class="flex items-center mb-3">
                    <div class="w-3 h-3 bg-blue-500 rounded-full mr-3"></div>
                    <h4 class="font-semibold text-gray-900 dark:text-white">Temporal Clustering</h4>
                </div>
                <p class="text-gray-700 dark:text-gray-300 text-sm">
                    Overdose events often cluster in time, suggesting environmental factors, contaminated drug supplies, or social networks that amplify risk across the community.
                </p>
            </div>
            
            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                <div class="flex items-center mb-3">
                    <div class="w-3 h-3 bg-orange-500 rounded-full mr-3"></div>
                    <h4 class="font-semibold text-gray-900 dark:text-white">Post-Release Vulnerability</h4>
                </div>
                <p class="text-gray-700 dark:text-gray-300 text-sm">
                    Overdoses frequently occur shortly after incarceration release periods, highlighting the critical need for transition support and immediate intervention strategies.
                </p>
            </div>
            
            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                <div class="flex items-center mb-3">
                    <div class="w-3 h-3 bg-red-500 rounded-full mr-3"></div>
                    <h4 class="font-semibold text-gray-900 dark:text-white">Fatal Outcome Patterns</h4>
                </div>
                <p class="text-gray-700 dark:text-gray-300 text-sm">
                    Fatal overdoses show distinct patterns that can inform risk assessment protocols and help identify patients requiring the most intensive intervention and monitoring.
                </p>
            </div>
            
            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                <div class="flex items-center mb-3">
                    <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                    <h4 class="font-semibold text-gray-900 dark:text-white">Intervention Windows</h4>
                </div>
                <p class="text-gray-700 dark:text-gray-300 text-sm">
                    Patient timelines reveal critical intervention windows where Community Paramedic engagement can redirect trajectories toward recovery and stability.
                </p>
            </div>
            
            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                <div class="flex items-center mb-3">
                    <div class="w-3 h-3 bg-purple-500 rounded-full mr-3"></div>
                    <h4 class="font-semibold text-gray-900 dark:text-white">System Integration</h4>
                </div>
                <p class="text-gray-700 dark:text-gray-300 text-sm">
                    The visualization highlights the intersection between healthcare, criminal justice, and social services, informing comprehensive care coordination strategies.
                </p>
            </div>
            
            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                <div class="flex items-center mb-3">
                    <div class="w-3 h-3 bg-yellow-500 rounded-full mr-3"></div>
                    <h4 class="font-semibold text-gray-900 dark:text-white">Resource Allocation</h4>
                </div>
                <p class="text-gray-700 dark:text-gray-300 text-sm">
                    Comprehensive case data enables strategic resource allocation, helping determine optimal staffing levels, response protocols, and community outreach priorities.
                </p>
            </div>
        </div>
    </div>
</section>
{% endblock content %}
