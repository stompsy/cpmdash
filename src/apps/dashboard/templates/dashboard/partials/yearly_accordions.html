{# Yearly Accordions Section #}
<div class="mt-20 mb-16">
    <div class="relative mb-12">
        <div class="absolute inset-0 flex items-center" aria-hidden="true">
            <div class="w-full border-t border-slate-300/70 dark:border-slate-700/70"></div>
        </div>
        <div class="relative flex justify-start">
            <div class="bg-white pr-8 dark:bg-gray-900">
                <div class="flex items-center gap-4">
                    <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-violet-500 to-violet-600 shadow-lg shadow-violet-500/30">
                        <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold tracking-tight text-gray-900 dark:text-white">Year-by-Year Evolution</h2>
                        <p class="text-sm text-gray-600 dark:text-slate-400">Community need, program response, and impact over time</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {# Accordions Container - Default to 2025 open #}
    <div class="space-y-6" x-data="{ openYear: 2025 }">
        {% for year_data in yearly_accordions %}
            <div>
                {# Accordion Header Button - Styled like quick stats cards #}
                <button
                    @click="{% if year_data.year >= 2024 %}openYear = openYear === {{ year_data.year }} ? null : {{ year_data.year }}{% endif %}"
                    class="group/year relative flex w-full items-center justify-between overflow-hidden rounded-xl border border-slate-200/80 bg-gradient-to-br from-slate-50 to-white px-6 py-4 text-left shadow-sm transition-all duration-300 {% if year_data.year >= 2024 %}hover:border-indigo-300 hover:shadow-lg dark:hover:border-indigo-500/50{% else %}cursor-not-allowed opacity-60{% endif %} dark:border-slate-700/60 dark:from-slate-800/50 dark:to-slate-900/30"
                    :class="openYear === {{ year_data.year }} ? 'border-indigo-300 shadow-lg dark:border-indigo-500/50' : ''"
                    {% if year_data.year < 2024 %}disabled{% endif %}
                >
                    {# Animated background circle #}
                    <div class="absolute -right-8 -top-8 h-32 w-32 rounded-full bg-indigo-500/5 transition-all duration-300 {% if year_data.year >= 2024 %}group-hover/year:scale-150{% endif %} dark:bg-indigo-400/5"></div>

                    <div class="relative flex items-center gap-4">
                        {# Year badge with calendar icon #}
                        <div class="flex h-14 w-14 items-center justify-center rounded-lg bg-gradient-to-br from-indigo-100 to-indigo-50 ring-4 ring-indigo-50 transition-all duration-300 {% if year_data.year >= 2024 %}group-hover/year:scale-110 group-hover/year:ring-indigo-100{% endif %} dark:from-indigo-500/20 dark:to-indigo-600/10 dark:ring-indigo-900/30 dark:group-hover/year:ring-indigo-800/40">
                            <svg class="h-7 w-7 text-indigo-600 dark:text-indigo-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                        </div>
                        <div>
                            <div class="flex items-center gap-2">
                                <span class="text-2xl font-bold text-gray-900 dark:text-white">{{ year_data.year }}</span>
                                {% if year_data.is_current %}
                                    <span class="rounded-full bg-emerald-100 px-2.5 py-0.5 text-xs font-semibold text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400">
                                        Current
                                    </span>
                                {% elif year_data.year < 2024 %}
                                    <span class="rounded-full bg-slate-100 px-2.5 py-0.5 text-xs font-semibold text-slate-600 dark:bg-slate-800/50 dark:text-slate-400">
                                        Coming Soon
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% if year_data.year >= 2024 %}
                    <div class="relative">
                        <svg
                            class="h-6 w-6 text-slate-400 transition-all duration-300 group-hover/year:text-indigo-500 dark:group-hover/year:text-indigo-400"
                            :class="openYear === {{ year_data.year }} ? 'rotate-180 text-indigo-500 dark:text-indigo-400' : ''"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2.5"
                            viewBox="0 0 24 24"
                        >
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                        </svg>
                    </div>
                    {% endif %}
                </button>

                {# Accordion Content - Story Sections without container #}
                {% if year_data.year >= 2024 %}
                <div
                    x-show="openYear === {{ year_data.year }}"
                    x-transition:enter="transition ease-out duration-200"
                    x-transition:enter-start="opacity-0 -translate-y-2"
                    x-transition:enter-end="opacity-100 translate-y-0"
                    x-transition:leave="transition ease-in duration-150"
                    x-transition:leave-start="opacity-100"
                    x-transition:leave-end="opacity-0"
                    class="mt-6"
                    x-cloak
                >
                    {# Include the story sections template with this year's data #}
                    {% include "dashboard/partials/story_sections.html" with story_sections=year_data.sections %}
                </div>
                {% endif %}
            </div>
        {% endfor %}
    </div>
</div>
