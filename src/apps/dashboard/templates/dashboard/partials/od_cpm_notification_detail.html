{# CPM Notification Detail Modal Content #}
<div class="p-6 sm:p-8">
    {# Header - Full Width #}
    <div class="mb-6">
        <div class="flex items-center gap-3 mb-2">
            <div class="flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-rose-100 ring-4 ring-rose-50 dark:bg-rose-500/20 dark:ring-rose-900/30">
                <svg class="h-5 w-5 text-rose-600 dark:text-rose-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                </svg>
            </div>
            <div>
                <h3 class="text-2xl font-bold text-gray-900 dark:text-white">CPM Notification Analysis</h3>
            </div>
        </div>
        <p class="text-sm text-gray-600 dark:text-slate-400 ml-13">Tracking how CPM teams are alerted to overdose incidents</p>
    </div>

    {# Quick Stats Grid - Full Width #}
    {% if notification_stats %}
    <div class="mb-8">
        <h4 class="mb-4 text-xs font-bold uppercase tracking-[0.15em] text-rose-600 dark:text-rose-400">Key Metrics</h4>
        <div class="grid grid-cols-2 gap-4 sm:grid-cols-4">
            {% for stat in notification_stats %}
                <div class="group/metric relative overflow-hidden rounded-xl border border-slate-200/80 bg-gradient-to-br from-slate-50 to-white px-4 py-3 transition-all duration-200 hover:border-rose-300 hover:shadow-lg dark:border-slate-700/60 dark:from-slate-800/50 dark:to-slate-900/30 dark:hover:border-rose-500/50">
                    <div class="absolute -right-4 -top-4 h-16 w-16 rounded-full bg-rose-500/5 transition-all duration-300 group-hover/metric:scale-150 dark:bg-rose-400/5"></div>
                    <div class="relative">
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ stat.value }}</p>
                        <p class="mt-1 text-[10px] font-bold uppercase tracking-[0.15em] text-gray-500 dark:text-slate-400">{{ stat.label }}</p>
                        <p class="mt-1 text-xs text-gray-600 dark:text-slate-400">{{ stat.description }}</p>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {# Chart and Insights Layout - Wider Chart, Narrower Insights #}
    <div class="grid grid-cols-1 gap-6 lg:grid-cols-5 lg:items-start">
        {# Chart - Takes 3 columns on large screens (60%) #}
        <div class="lg:col-span-3">
            <h4 class="mb-4 text-xs font-bold uppercase tracking-[0.15em] text-rose-600 dark:text-rose-400">Notification Method Distribution</h4>
            <div class="rounded-xl border border-slate-200 bg-white p-6 dark:border-slate-700 dark:bg-slate-800/50 flex items-center justify-center">
                <div class="plotly-chart-wrapper relative w-full overflow-hidden rounded-xl">
                    {% autoescape off %}{{ notification_chart|safe }}{% endautoescape %}
                </div>
            </div>
        </div>

        {# Strategic Insights - Takes 2 columns on large screens (40%) #}
        <div class="lg:col-span-2">
            <h4 class="mb-4 text-xs font-bold uppercase tracking-[0.15em] text-rose-600 dark:text-rose-400">Strategic Insights</h4>
            <div class="rounded-xl border border-slate-200 bg-gradient-to-br from-rose-50 to-white p-6 dark:border-slate-700 dark:from-rose-900/20 dark:to-slate-800/50 flex flex-col">
                <div class="flex items-start gap-3">
                    <svg class="h-5 w-5 mt-0.5 shrink-0 text-rose-600 dark:text-rose-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                    </svg>
                    <div>
                        <h5 class="font-semibold text-gray-900 dark:text-white mb-3">Why This Matters</h5>
                        <div class="space-y-3 text-sm leading-relaxed text-gray-600 dark:text-slate-400">
                            <p>
                                <strong>Communication Infrastructure:</strong> How CPM teams learn about overdose incidents fundamentally shapes response speed and effectiveness. Notification methods range from real-time 911 dispatch integration to delayed faxes and voicemails. The distribution of notification methods reveals your system's technological maturity and identifies opportunities for modernization.
                            </p>
                            <p>
                                <strong>Response Time Driver:</strong> Notification method directly impacts referral delays. Electronic alerts (CAD integration, automated emails, mobile push notifications) enable same-day response. Manual methods (phone calls, paper forms, scheduled reports) introduce lag time that can stretch to days. Analyzing notification patterns alongside delay data shows exactly which methods work—and which need upgrading.
                            </p>
                            <p>
                                <strong>Fatal Case Alert Failures:</strong> When fatal cases are examined through a notification lens, critical gaps emerge: Were we notified at all? How quickly? Via what method? Fatal cases with delayed or missing notifications represent preventable deaths—strong ammunition for advocating mandatory real-time reporting requirements.
                            </p>
                            <p>
                                <strong>Partnership Diagnostics:</strong> Notification method varies by referral source. Fire/EMS may have CAD integration. Hospitals might use case management software. Police may rely on email. This metric reveals which partnerships have invested in seamless data exchange versus those still using stone-age fax machines. Prioritize technology upgrades with high-volume partners.
                            </p>
                            <p class="pt-2 border-t border-slate-200 dark:border-slate-700">
                                <strong>Action Items:</strong> Advocate for 911 CAD system integration, implement mobile alerting platforms for CPM teams, establish real-time notification SLAs with hospital partners, sunset fax/paper-based workflows, and track notification-to-response time by method to quantify ROI of technology investments.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
