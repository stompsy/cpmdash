{# Referral Delay Detail Modal Content #}
<div class="p-6 sm:p-8">
    {# Header - Full Width #}
    <div class="mb-6">
        <div class="flex items-center gap-3 mb-2">
            <div class="flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-rose-100 ring-4 ring-rose-50 dark:bg-rose-500/20 dark:ring-rose-900/30">
                <svg class="h-5 w-5 text-rose-600 dark:text-rose-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <div>
                <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Referral Delay Analysis</h3>
            </div>
        </div>
        <p class="text-sm text-gray-600 dark:text-slate-400 ml-13">Measuring time-to-engagement and referral processing speed</p>
    </div>

    {# Quick Stats Grid - Full Width #}
    {% if delay_stats %}
    <div class="mb-8">
        <h4 class="mb-4 text-xs font-bold uppercase tracking-[0.15em] text-rose-600 dark:text-rose-400">Key Metrics</h4>
        <div class="grid grid-cols-2 gap-4 sm:grid-cols-4">
            {% for stat in delay_stats %}
                <div class="group/metric relative overflow-hidden rounded-xl border border-slate-200/80 bg-gradient-to-br from-slate-50 to-white px-4 py-3 transition-all duration-200 hover:border-rose-300 hover:shadow-lg dark:border-slate-700/60 dark:from-slate-800/50 dark:to-slate-900/30 dark:hover:border-rose-500/50">
                    <div class="absolute -right-4 -top-4 h-16 w-16 rounded-full bg-rose-500/5 transition-all duration-300 group-hover/metric:scale-150 dark:bg-rose-400/5"></div>
                    <div class="relative">
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ stat.value }}</p>
                        <p class="mt-1 text-[10px] font-bold uppercase tracking-[0.15em] text-gray-500 dark:text-slate-400">{{ stat.label }}</p>
                        <p class="mt-1 text-xs text-gray-600 dark:text-slate-400">{{ stat.description }}</p>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {# Chart and Insights Layout - Wider Chart, Narrower Insights #}
    <div class="grid grid-cols-1 gap-6 lg:grid-cols-5 lg:items-start">
        {# Chart - Takes 3 columns on large screens (60%) #}
        <div class="lg:col-span-3">
            <h4 class="mb-4 text-xs font-bold uppercase tracking-[0.15em] text-rose-600 dark:text-rose-400">Delay Distribution</h4>
            <div class="rounded-xl border border-slate-200 bg-white p-6 dark:border-slate-700 dark:bg-slate-800/50 flex items-center justify-center">
                <div class="plotly-chart-wrapper relative w-full overflow-hidden rounded-xl">
                    {% autoescape off %}{{ delay_chart|safe }}{% endautoescape %}
                </div>
            </div>
        </div>

        {# Strategic Insights - Takes 2 columns on large screens (40%) #}
        <div class="lg:col-span-2">
            <h4 class="mb-4 text-xs font-bold uppercase tracking-[0.15em] text-rose-600 dark:text-rose-400">Strategic Insights</h4>
            <div class="rounded-xl border border-slate-200 bg-gradient-to-br from-rose-50 to-white p-6 dark:border-slate-700 dark:from-rose-900/20 dark:to-slate-800/50 flex flex-col">
                <div class="flex items-start gap-3">
                    <svg class="h-5 w-5 mt-0.5 shrink-0 text-rose-600 dark:text-rose-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                    </svg>
                    <div>
                        <h5 class="font-semibold text-gray-900 dark:text-white mb-3">Why This Matters</h5>
                        <div class="space-y-3 text-sm leading-relaxed text-gray-600 dark:text-slate-400">
                            <p>
                                <strong>Time Is Brain (and Life):</strong> In overdose response, every minute counts. Referral delays measure the gap between overdose occurrence and CPM engagement—a critical window where individuals are most vulnerable and most receptive to intervention. Shorter delays correlate with better outcomes, higher engagement rates, and reduced risk of repeat overdose.
                            </p>
                            <p>
                                <strong>System Performance Indicator:</strong> Delay patterns reveal operational bottlenecks in your referral ecosystem. Are delays caused by reporting lags from first responders? Data entry backlogs? Weekends and holidays? Geographic distance? Identifying delay sources allows targeted process improvements—the difference between a 72-hour response and a same-day response can determine whether someone accepts help or walks away.
                            </p>
                            <p>
                                <strong>Fatal Case Context:</strong> Analyzing delays among fatal cases is sobering but essential. Did the individual die before CPM could reach them? Was there a second overdose during the delay period? Fatal cases with long delays highlight missed opportunities and underscore the urgency of rapid response protocols.
                            </p>
                            <p>
                                <strong>Equity Lens:</strong> Delay analysis often surfaces disparities. Do certain zip codes, referral sources, or demographic groups experience longer delays? Rural vs urban response times? Night shift vs day shift? Equity in response time is equity in access to life-saving care.
                            </p>
                            <p class="pt-2 border-t border-slate-200 dark:border-slate-700">
                                <strong>Action Items:</strong> Set aggressive delay reduction targets (e.g., 24-hour response standard), streamline referral intake processes, implement weekend/holiday coverage, use predictive models to pre-position resources, and advocate for real-time data sharing between EMS and CPM teams.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
