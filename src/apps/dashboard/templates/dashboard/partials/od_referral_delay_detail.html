{# Referral Delay Detail Modal Content #}
<div class="flex h-full flex-col bg-white dark:bg-slate-900">
    {# Content Header doubles as card header; solid, neutral tone #}
    <div class="sticky top-0 z-20 flex items-start justify-between border-b border-slate-200/80 bg-slate-50 px-6 py-5 text-sm leading-6 dark:border-slate-800 dark:bg-slate-900/95">
        <div class="flex items-start gap-4">
            <div>
                <p class="text-[11px] font-semibold uppercase tracking-[0.18em] text-slate-700/90 dark:text-slate-300/80">OD Referrals</p>
                <h3 class="mt-1 text-lg font-semibold leading-snug text-slate-900 dark:text-white">Referral Delay Analysis</h3>
                <p class="mt-2 max-w-2xl text-sm text-slate-700 dark:text-slate-300/90">
                    How long it takes for CPM to engage people after an overdose—and where time-to-contact is
                    getting stuck.
                </p>
            </div>
        </div>
        <button
            type="button"
            class="group ml-4 inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-4 py-2 text-xs font-semibold uppercase tracking-wider text-slate-600 shadow-sm transition-all hover:border-rose-200 hover:bg-rose-50 hover:text-rose-600 focus:outline-none focus:ring-2 focus:ring-rose-500 focus:ring-offset-2 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-300 dark:hover:border-rose-900/50 dark:hover:bg-rose-900/20 dark:hover:text-rose-400 dark:focus:ring-offset-slate-900"
            onclick="document.getElementById('od-referral-delay-modal-overlay').classList.add('hidden')"
            aria-label="Close detail"
        >
            <span>Close</span>
            <svg class="h-4 w-4 transition-transform duration-300 group-hover:rotate-90" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
    </div>

    <div class="flex-1 overflow-y-auto">
        {# Key Metrics - Full Width Band #}
        {% if delay_stats %}
        <div class="border-b border-slate-100 bg-slate-50/60 px-6 py-8 dark:border-slate-800 dark:bg-slate-800/40">
            <h4 class="mb-4 text-[11px] font-semibold uppercase tracking-[0.18em] text-slate-800 dark:text-slate-100">Key metrics</h4>
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
                {% for stat in delay_stats %}
                <div class="group/metric relative overflow-hidden rounded-2xl border border-slate-200/80 bg-white px-4 py-3 transition-all duration-200 hover:border-rose-300 hover:shadow-md dark:border-slate-700/70 dark:bg-slate-900/50 dark:hover:border-rose-500/60">
                    <div class="absolute -right-4 -top-6 h-14 w-14 rounded-full bg-rose-500/5 transition-transform duration-300 group-hover/metric:scale-150 dark:bg-rose-400/10"></div>
                    <div class="relative">
                        <dt class="truncate text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500 dark:text-slate-400">{{ stat.label }}</dt>
                        <dd class="mt-1 text-2xl font-semibold leading-snug text-slate-900 dark:text-white">{{ stat.value }}</dd>
                        <dd class="mt-1 text-sm text-slate-600 dark:text-slate-400">{{ stat.description }}</dd>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {# Chart Section #}
        {% if delay_chart %}
        <div class="px-6 py-8">
            <div class="mb-4 flex items-center justify-between text-sm">
                <h4 class="text-[11px] font-semibold uppercase tracking-[0.18em] text-slate-700 dark:text-slate-300">Delay Distribution</h4>
            </div>
            <div class="plotly-chart-wrapper w-full">
                {% autoescape off %}{{ delay_chart|safe }}{% endautoescape %}
            </div>
        </div>
        {% endif %}

        {# Insights Section - Full Width Band #}
        <div class="border-t border-amber-100/80 bg-amber-50/80 px-6 py-8 text-sm leading-6 dark:border-amber-900/50 dark:bg-amber-950/30">
            <div class="space-y-2 text-amber-950 dark:text-amber-50">
                <h4 class="text-[11px] font-bold uppercase tracking-[0.18em] text-amber-900 dark:text-amber-200">Why This Matters</h4>
                <p>
                    <strong>Time Is Brain (and Life):</strong> In overdose response, every minute counts. Referral delays measure the gap between overdose occurrence and CPM engagement—a critical window where individuals are most vulnerable and most receptive to intervention. Shorter delays correlate with better outcomes, higher engagement rates, and reduced risk of repeat overdose.
                </p>
                <p>
                    <strong>System Performance Indicator:</strong> Delay patterns reveal operational bottlenecks in your referral ecosystem. Are delays caused by reporting lags from first responders? Data entry backlogs? Weekends and holidays? Geographic distance? Identifying delay sources allows targeted process improvements—the difference between a 72-hour response and a same-day response can determine whether someone accepts help or walks away.
                </p>
                <p>
                    <strong>Fatal Case Context:</strong> Analyzing delays among fatal cases is sobering but essential. Did the individual die before CPM could reach them? Was there a second overdose during the delay period? Fatal cases with long delays highlight missed opportunities and underscore the urgency of rapid response protocols.
                </p>
                <p>
                    <strong>Equity Lens:</strong> Delay analysis often surfaces disparities. Do certain zip codes, referral sources, or demographic groups experience longer delays? Rural vs urban response times? Night shift vs day shift? Equity in response time is equity in access to life-saving care.
                </p>
                <p class="mt-4 border-t border-amber-200/50 pt-4 font-medium dark:border-amber-800/50">
                    Action Items: Set aggressive delay reduction targets (e.g., 24-hour response standard), streamline referral intake processes, implement weekend/holiday coverage, use predictive models to pre-position resources, and advocate for real-time data sharing between EMS and CPM teams.
                </p>
            </div>
        </div>
    </div>
</div>
