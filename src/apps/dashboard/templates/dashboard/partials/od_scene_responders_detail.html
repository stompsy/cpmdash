{# Scene Responder Detail Modal Content #}
<div class="flex h-full flex-col bg-white dark:bg-slate-900">
    {# Content Header doubles as card header; solid, neutral tone #}
    <div class="sticky top-0 z-20 flex items-start justify-between border-b border-slate-200/80 bg-slate-50 px-6 py-5 text-sm leading-6 dark:border-slate-800 dark:bg-slate-900/95">
        <div class="flex items-start gap-4">
            <div>
                <p class="text-[11px] font-semibold uppercase tracking-[0.18em] text-slate-700/90 dark:text-slate-300/80">OD Referrals</p>
                <h3 class="mt-1 text-lg font-semibold leading-snug text-slate-900 dark:text-white">Scene Responder Analysis</h3>
                <p class="mt-2 max-w-2xl text-sm text-slate-700 dark:text-slate-300/90">
                    Who actually shows up at overdose scenes—EMS, police, peers, bystanders—and what that mix
                    means for engagement, safety, and stigma.
                </p>
            </div>
        </div>
        <button
            type="button"
            class="group ml-4 inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-4 py-2 text-xs font-semibold uppercase tracking-wider text-slate-600 shadow-sm transition-all hover:border-rose-200 hover:bg-rose-50 hover:text-rose-600 focus:outline-none focus:ring-2 focus:ring-rose-500 focus:ring-offset-2 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-300 dark:hover:border-rose-900/50 dark:hover:bg-rose-900/20 dark:hover:text-rose-400 dark:focus:ring-offset-slate-900"
            onclick="document.getElementById('od-scene-responders-modal-overlay').classList.add('hidden')"
            aria-label="Close detail"
        >
            <span>Close</span>
            <svg class="h-4 w-4 transition-transform duration-300 group-hover:rotate-90" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
    </div>

    <div class="flex-1 overflow-y-auto">
        {# Key Metrics - Full Width Band #}
        {% if responder_stats %}
        <div class="border-b border-slate-100 bg-slate-50/60 px-6 py-8 dark:border-slate-800 dark:bg-slate-800/40">
            <h4 class="mb-4 text-[11px] font-semibold uppercase tracking-[0.18em] text-slate-800 dark:text-slate-100">Key metrics</h4>
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
                {% for stat in responder_stats %}
                <div class="group/metric relative overflow-hidden rounded-2xl border border-slate-200/80 bg-white px-4 py-3 transition-all duration-200 hover:border-rose-300 hover:shadow-md dark:border-slate-700/70 dark:bg-slate-900/50 dark:hover:border-rose-500/60">
                    <div class="absolute -right-4 -top-6 h-14 w-14 rounded-full bg-rose-500/5 transition-transform duration-300 group-hover/metric:scale-150 dark:bg-rose-400/10"></div>
                    <div class="relative">
                        <dt class="truncate text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500 dark:text-slate-400">{{ stat.label }}</dt>
                        <dd class="mt-1 text-2xl font-semibold leading-snug text-slate-900 dark:text-white">{{ stat.value }}</dd>
                        <dd class="mt-1 text-sm text-slate-600 dark:text-slate-400">{{ stat.description }}</dd>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {# Chart Section #}
        <div class="px-6 py-8">
            <div class="mb-4 flex items-center justify-between text-sm">
                <h4 class="text-[11px] font-semibold uppercase tracking-[0.18em] text-slate-700 dark:text-slate-300">Responder distribution</h4>
            </div>
            <div class="plotly-chart-wrapper w-full">
                {% autoescape off %}{{ responder_chart|safe }}{% endautoescape %}
            </div>
        </div>

        {# Insights Section #}
        <div class="border-t border-amber-100 bg-amber-50/50 px-6 py-8 dark:border-amber-900/30 dark:bg-amber-900/10">
            <div class="flex gap-4">
                <div class="shrink-0">
                    <div class="flex h-10 w-10 items-center justify-center rounded-full bg-amber-100 text-amber-600 dark:bg-amber-900/30 dark:text-amber-400">
                        <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.383a14.406 14.406 0 01-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 10-7.517 0c.85.493 1.509 1.333 1.509 2.316V18" />
                        </svg>
                    </div>
                </div>
                <div class="space-y-4">
                    <div>
                        <h3 class="text-base font-semibold text-slate-900 dark:text-white">Why This Matters</h3>
                        <p class="mt-1 text-sm text-slate-600 dark:text-slate-400">
                            Overdose scenes are complex emergencies involving EMS, law enforcement, peer support specialists, and bystanders. Understanding who shows up—and in what numbers—reveals your response ecosystem's structure.
                        </p>
                    </div>

                    <div class="grid gap-6 sm:grid-cols-2">
                        <div class="space-y-3">
                            <h4 class="text-sm font-medium text-slate-900 dark:text-white">Resource Allocation</h4>
                            <p class="text-sm leading-relaxed text-slate-600 dark:text-slate-400">
                                Average responder counts per scene drive staffing and deployment models. If most scenes have 2-3 EMS personnel but 4-5 police officers, that's a policy conversation about whether law enforcement is the right primary responder.
                            </p>
                        </div>
                        <div class="space-y-3">
                            <h4 class="text-sm font-medium text-slate-900 dark:text-white">Scene Dynamics</h4>
                            <p class="text-sm leading-relaxed text-slate-600 dark:text-slate-400">
                                Too many responders creates scene chaos—commands conflict, patients feel overwhelmed, privacy evaporates. Too few means inadequate care and safety risks. The distribution chart shows whether your scenes are understaffed, overstaffed, or right-sized.
                            </p>
                        </div>
                        <div class="space-y-3">
                            <h4 class="text-sm font-medium text-slate-900 dark:text-white">Stigma & Engagement</h4>
                            <p class="text-sm leading-relaxed text-slate-600 dark:text-slate-400">
                                Law enforcement presence at overdose scenes significantly impacts whether individuals accept follow-up services. Heavy police presence (especially multiple officers for non-criminal ODs) reinforces stigma and reduces CPM engagement rates.
                            </p>
                        </div>
                        <div class="space-y-3">
                            <h4 class="text-sm font-medium text-slate-900 dark:text-white">Peer Support Opportunity</h4>
                            <p class="text-sm leading-relaxed text-slate-600 dark:text-slate-400">
                                Peer support specialists have unique credibility and rapport-building capacity—but only if they're actually on scene. Low peer presence suggests underutilization of a powerful resource. High presence indicates mature recovery-oriented systems.
                            </p>
                        </div>
                    </div>

                    <div class="mt-4 rounded-lg border border-amber-200 bg-amber-50 p-4 dark:border-amber-800 dark:bg-amber-900/20">
                        <h4 class="text-sm font-semibold text-amber-900 dark:text-amber-200">Strategic Action</h4>
                        <p class="mt-1 text-sm text-amber-800 dark:text-amber-300">
                            Advocate for scene response protocols that prioritize medical/peer responses over law enforcement for non-violent ODs, train cross-disciplinary teams on role clarity and trauma-informed approaches, and track responder presence against engagement outcomes.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
