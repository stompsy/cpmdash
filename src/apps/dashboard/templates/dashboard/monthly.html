{% extends "base.html" %}
{% load static %}

{% block pageName %}odreferralsMonthly{% endblock pageName %}
{% block title %} OD Referrals - Monthly Trends {% endblock title %}

{% block content %}
<!-- Introduction - Full Width -->
<section class="col-span-12 mb-16">
    <div class="relative isolate overflow-hidden bg-white dark:bg-gray-900 px-2 py-12 sm:px-4 sm:py-16 lg:overflow-visible lg:px-0">
        <div class="absolute inset-0 -z-10 overflow-hidden">
            <svg class="absolute top-0 left-[max(50%,25rem)] h-256 w-512 -translate-x-1/2 mask-[radial-gradient(64rem_64rem_at_top,white,transparent)] dark:mask-[radial-gradient(64rem_64rem_at_top,black,transparent)] stroke-gray-200 dark:stroke-gray-700" aria-hidden="true">
                <defs>
                    <pattern id="e813992c-7d03-4cc4-a2bd-151760b470a0" width="200" height="200" x="50%" y="-1" patternUnits="userSpaceOnUse">
                        <path d="M100 200V.5M.5 .5H200" fill="none" />
                    </pattern>
                </defs>
                <svg x="50%" y="-1" class="overflow-visible fill-gray-50 dark:fill-gray-800">
                    <path d="M-100.5 0h201v201h-201Z M699.5 0h201v201h-201Z M499.5 400h201v201h-201Z M-300.5 600h201v201h-201Z" stroke-width="0" />
                </svg>
                <rect width="100%" height="100%" stroke-width="0" fill="url(#e813992c-7d03-4cc4-a2bd-151760b470a0)" />
            </svg>
        </div>
        <div class="mx-auto grid max-w-2xl grid-cols-1 gap-x-8 gap-y-12 lg:mx-0 lg:max-w-none lg:grid-cols-2 lg:items-start lg:gap-y-10">
            <div class="lg:col-span-2 lg:col-start-1 lg:row-start-1 lg:mx-auto lg:grid lg:w-full lg:grid-cols-2 lg:gap-x-8 lg:px-8">
                <div class="lg:pr-4">
                    <div class="lg:max-w-2xl">
                        <p class="text-base/7 font-semibold text-indigo-600 dark:text-indigo-400">Post Overdose Response Team (PORT)</p>
                        <h1 class="mt-2 text-4xl font-semibold tracking-tight text-pretty text-gray-900 dark:text-white sm:text-5xl">
                            Overdose Trends Over Time
                        </h1>
                        <p class="mt-6 text-xl/8 text-gray-700 dark:text-gray-300">
                            Tracking monthly overdose counts helps us evaluate program impact, allocate resources where they're
                            needed most, and spot emerging risks in near real-time. Understanding temporal patterns enables
                            data-driven decisions for community health interventions.
                        </p>
                    </div>
                </div>
            </div>

            <div class="lg:sticky lg:top-28 lg:col-start-2 lg:row-span-2 lg:row-start-1 lg:overflow-hidden">
                <!-- Data Cards -->
                <div class="relative z-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-6 bg-white/80 dark:bg-gray-900/80 p-4 rounded-xl shadow ring-1 ring-inset ring-gray-200 dark:ring-gray-800">
                    <!-- Total Overdoses -->
                    <div class="flex items-center rounded-lg p-3 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700">
                        <div>
                            <dt class="text-sm font-medium text-gray-700 dark:text-gray-300">Total Overdoses</dt>
                            <dd class="mt-1 text-2xl font-bold text-gray-900 dark:text-white">{{ total_overdoses }}</dd>
                        </div>
                    </div>

                    <!-- Fatal Overdoses -->
                    <div class="flex items-center rounded-lg p-3 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700">
                        <div>
                            <dt class="text-sm font-medium text-gray-700 dark:text-gray-300">Fatal Overdoses</dt>
                            <dd class="mt-1 text-2xl font-bold text-red-700 dark:text-red-300">{{ fatal_overdoses }}</dd>
                        </div>
                    </div>

                    <!-- Repeat Overdoses -->
                    <div class="flex items-center rounded-lg p-3 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700">
                        <div>
                            <dt class="text-sm font-medium text-gray-700 dark:text-gray-300">Repeat Overdoses</dt>
                            <div class="flex justify-between items-baseline">
                                <dd class="mt-1 text-2xl font-bold text-orange-700 dark:text-orange-300">{{ repeat_overdoses }}</dd>
                                <span class="ml-3 text-sm font-bold text-gray-600 dark:text-gray-400 align-middle">{{ repeat_patients }} patients â€¢ {{ percent_repeat }}%</span>
                            </div>

                        </div>
                    </div>

                    <!-- Referral Success Rate -->
                    <div class="flex items-center rounded-lg p-3 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700">
                        <div>
                            <dt class="text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center">
                                Referral Success
                                <span class="group relative ml-2">
                                    <svg class="w-4 h-4 text-gray-500 dark:text-gray-400 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    <span class="absolute bottom-full left-1/2 -translate-x-1/2 w-48 p-2 bg-gray-800 text-white text-xs rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none">
                                        Excludes 21 cases initiated internally, not from direct referrals.
                                    </span>
                                </span>
                            </dt>
                            <dd class="mt-1 text-2xl font-bold text-green-700 dark:text-green-300">{{ referral_success_rate }}%</dd>
                        </div>
                    </div>
                </div>

            </div>

            <div class="lg:col-span-2 lg:col-start-1 lg:row-start-2 lg:mx-auto lg:grid lg:w-full lg:grid-cols-2 lg:gap-x-8 lg:px-8">
                <div class="lg:pr-4">
                    <div class="lg:max-w-2xl text-base/7 text-gray-700 dark:text-gray-300">
                        <h2 class="mt-16 text-2xl font-bold tracking-tight text-gray-900 dark:text-white flex items-center">
                            <svg class="w-6 h-6 mr-3 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
                            </svg>
                            Why Track Fatal and Non-Fatal Overdoses Over Time?
                        </h2>
                        <p class="mt-6">
                            Identifying and understanding patterns in overdose types allows Community Paramedics to optimize outreach and intervention strategies.
                        </p>
                        <ul role="list" class="mt-8 space-y-8 text-gray-600 dark:text-gray-400 list-disc pl-5">
                            <li>
                                <span>
                                    <strong class="font-semibold text-gray-900 dark:text-white">Fatal Overdose Reduction.</strong> In the 12 months following the launch of the Post Overdose Response Team, Clallam County's fatal overdose rate dropped by 63%, from 73.3 to 34.8 per 100,000 population.
                                </span>
                            </li>
                            <li>
                                <span>
                                    <strong class="font-semibold text-gray-900 dark:text-white">Early Intervention Success.</strong> When Community Paramedics respond to an overdose, there is a greater than 78% success rate in linking survivors to Substance Use Disorder (SUD) services, creating a warm handoff to co-response partners.
                                </span>
                            </li>
                            <li>
                                <span>
                                    <strong class="font-semibold text-gray-900 dark:text-white">Repeat Overdose Prevention.</strong> By intervening at the time of overdose, CPMs can treat the severe symptoms of precipitated withdrawal, which often leads individuals to use again. This reduces repeat overdoses and builds trust for referrals.
                                </span>
                            </li>
                            <li>
                                <span>
                                    <strong class="font-semibold text-gray-900 dark:text-white">Real-Time Public Health Response.</strong> CPMs are not tied to the next 911 dispatch, enabling them to establish trusted relationships and provide point-of-care support.
                                </span>
                            </li>
                        </ul>

                        <h2 class="mt-16 text-2xl font-bold tracking-tight text-gray-900 dark:text-white flex items-center">
                            <svg class="w-6 h-6 mr-3 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Time-Based Analysis Benefits
                        </h2>
                        <p class="mt-6">
                            Monthly trend analysis helps predict resource needs and enables proactive intervention. By understanding when overdoses occur most frequently, the program can optimize scheduling for Community Paramedics, who are not tied to the next 911 dispatch. This ensures that line staff firefighters remain available for high-acuity emergencies while CPMs handle specialized overdose response and follow-up.
                        </p>

                        <h2 class="mt-16 text-2xl font-bold tracking-tight text-gray-900 dark:text-white flex items-center">
                            <svg class="w-6 h-6 mr-3 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            Focus on Monthly Trends
                        </h2>
                        <p class="mt-6">
                            Analyzing overdose data on a monthly basis is crucial for identifying short-term trends and seasonal patterns. This granularity allows for rapid adjustments to public health strategies, ensuring that resources are deployed effectively to meet the evolving needs of the community. It helps answer critical questions: Are overdoses increasing or decreasing? Are there specific times of the year that are higher risk? This focus on monthly data provides actionable insights for timely interventions.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Monthly Overdose Chart Section -->
<section class="col-span-12 mb-16">
    <div class="relative isolate overflow-hidden bg-white dark:bg-gray-900 px-2 sm:px-4 lg:overflow-visible lg:px-0">
        <div class="mx-auto grid max-w-2xl grid-cols-1 gap-x-8 gap-y-16 lg:mx-0 lg:max-w-none lg:grid-cols-1 lg:items-start lg:gap-y-10">
            <div class="lg:pr-4 lg:pl-8">
                <div class="mb-12">
                    <div class="mb-6 relative">
                        <!-- Title background highlight -->
                        <div class="absolute -inset-4 bg-gradient-to-r from-blue-50 via-blue-100 to-blue-50 dark:from-blue-800/30 dark:via-blue-700/30 dark:to-blue-800/30 rounded-lg -z-10 opacity-60"></div>
                        <h2 class="text-3xl font-bold tracking-tight text-gray-900 dark:text-white relative flex items-center">
                            <svg class="w-8 h-8 mr-4 mb-1 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
                            </svg>
                            Overdoses by Year and Month
                        </h2>
                    </div>
                    <p class="text-base/7 text-gray-700 dark:text-gray-300 mb-8">
                        Stacked view showing fatal vs non-fatal overdoses over time with interactive monthly breakdowns and trend analysis. Hover over any bar for detailed monthly statistics and percentage breakdowns.
                    </p>
                    <div class="border border-gray-200 dark:border-gray-700 rounded-2xl bg-white/20 dark:bg-gray-800/20">
                        <div class="bg-transparent">
                            {% autoescape off %}{{ od_monthly|safe }}{% endautoescape %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock content %}
